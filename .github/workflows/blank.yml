name: "Sonar: SonarQube Web"

on:
  pull_request:
    types: [opened, synchronize, reopened]  # Trigger for PR events
    paths:
      - './backend/**'
      - './frontend/**'
  push:
    branches:
      - main  # Trigger for pushes to the main branch
    paths:
      - './backend/**'
      - './frontend/**'

permissions:
  id-token: write
  contents: read

jobs:
  Sonar-Scan-Backend:
    name: SonarQube Scan for Backend Code  
    if: github.event.action != 'closed'  # No need for this condition on push
    runs-on: ubuntu-latest
    steps:
      - name: Check for Backend Changes
        run: |
          echo "Running SonarQube scan for the backend..."
          echo "Working Directory: ./backend"
          # Simulate the SonarQube token usage
          echo "Using SonarQube Token: SONAR_TOKEN_BACKEND"

  Sonar-Scan-Frontend:
    name: SonarQube Scan for Frontend Code  
    if: github.event.action != 'closed'  # No need for this condition on push
    runs-on: ubuntu-latest
    steps:
      - name: Check for Frontend Changes
        run: |
          echo "Running SonarQube scan for the frontend..."
          echo "Working Directory: ./frontend"
          # Simulate the SonarQube token usage
          echo "Using SonarQube Token: SONAR_TOKEN_FRONTEND"
